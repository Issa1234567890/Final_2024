---
title: "Covid91 vaccine study Final2025"
author: "Issa Darrouj"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
M = filter(FinalData, sex =="M")
F = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

# Coding details

Separating the variables into the four groups they belonged to was crucial for an effective evaluation of the data. "M", "F", "gay", and "drug users" are the four variables I created. To determine whether or not they should get the Covid-19 vaccine, they were kept apart. I did this in order to generate the efficacy intervals. They were kept in different variables. 

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot displays the male population and the correlation between contracting COVID-19 and receiving a placebo or the vaccination. 

The first graph displays the number of individuals who either had COVID-19 or were well, as well as whether or not they received a placebo. The second graph displays the proportion of individuals who received either the COVID-19 vaccination or a placebo, as well as whether or not they had COVID. They are divided into groups based on whether they received the Covid-19 vaccination or a placebo. Of those who contracted COVID-19, those who received a placebo were plotted as a large bar, at around 75%, while those who received the vaccination were much smaller, at about 25%. There was a 50/50 divide between those who received the vaccination and those who took a placebo among those who were okay. 

I used a lot of codes to plot this. The code block that starts with dd2, which appears to be where the environment pane is used and contains four variables. Treatment, infected, count, and percent (which stands for percent) are some of these factors. The basicC is the name of the second group. It has a list of eleven variables that may be seen in the environment section. This is to establish the initial plan. The final set of codes is the basicCC, which is likewise located in the files pane. It has eleven variables that are useful for making the second plot, the percentage plot. 


### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

The exact percentages of guys who contracted COVID-19 after receiving either the vaccination or a placebo are displayed in these numerical results. 

Compared to the percentage of individuals who contracted COVID-19 after receiving the vaccination (26.20%), the number of men who contracted the virus after receiving a placebo was a staggering 73.80%. Of the guys who were well, 49.99% of those who received the vaccination and 50.01% of those who received a placebo were well. Given that only 26.20% of those who received the vaccination contracted COVID-19, this indicates that the vaccine is successful in men. COVID-19 was far more common in those who took the placebo. This is crucial. 

### Inferential Results 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Msfish <- fisher.test(table1)
Msfish
```

Out of all these outcomes, the Fisher's Exact test output is the one that requires the greatest attention. The resultant p-value is a very tiny 0.00000000000022. It is essentially zero. This indicates that it is unlikely that these outcomes happened by accident. 

This indicates a solid rejection of the null hypothesis that COVID-19 infection is unrelated to sex. 

2.815604 is the odds ratio. This indicates that the risk of contracting COVID-19 was nearly three times higher for those who received a placebo than for those who received the vaccination. This is really important. Additionally, it indicates that the vaccination is probably safe. 


```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

The efficacy of the COVID-19 vaccination for men is shown in the region above. It is crucial to understand that a vaccination is successful if its efficiency is more than 50%. We can determine that the vaccination is successful in preventing males from contracting COVID-19 based on the interval shown above. 

The vaccine's effectiveness is roughly represented by the odds ratio. The men' odds ratio is 73.8. The confidence range for efficacy is somewhere between 68.85 and 78.32. 


## Females

### Barplot

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the population of females and the correlation between contracting COVID-19 and receiving a placebo or the vaccination. 

The first graph shows how many people had COVID-19 or were healthy and whether they got a placebo. The second graph displays the proportion of individuals who received either the COVID-19 vaccination or a placebo, as well as whether or not they had COVID. They are divided into groups based on whether they received the Covid-19 vaccination or a placebo. 

This figure indicates that around 35% of female COVID-19 patients received the vaccination and approximately 65% received a placebo. Additionally, it demonstrates that the percentage of females who were unharmed by either the placebo or the immunization was almost 50/50 (the vaccine was somewhat higher). It seems that more persons got COVID-19 with the vaccination and fewer people got it with the placebo when compared to the male population. The fact that the placebo causes more cases of COVID-19 than the immunization does not change, though. 

I used a lot of codes to plot this. The code block that starts with dd2, which appears to be where the environment pane is used and contains four variables. Treatment, infected, count, and percent (which stands for percent) are some of these factors. The basicC is the name of the second group. It has a list of eleven variables that may be seen in the environment section. This is to establish the initial plan. The final set of codes is the basicCC, which is likewise located in the files pane. It has eleven variables that are useful for making the second plot, the percentage plot. 

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

The exact percentages of females who contracted COVID-19 after receiving either the vaccination or a placebo are displayed in these numerical findings. 

According to the figures I estimated from the barplot, the percentage of females who contracted COVID-19 after receiving a placebo was much higher at 65% than the percentage of individuals who contracted the virus after receiving the vaccination (35%). 50% of the women who received a placebo and 50% of those who received the vaccination were among the females who were deemed healthy. If just 35% of those who received the vaccination contracted COVID-19, this indicates that the vaccine is efficacious for females. COVID-19 was far more common in those who took the placebo. This is important. 

### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
Fsfish <- fisher.test(table1)
Fsfish
```

Out of all these outcomes, the Fisher's Exact test output is the one that requires the greatest attention. The resultant p-value is a very tiny 0.000000001. It is essentially zero. This indicates that it is unlikely that these outcomes happened by accident. 

This indicates a robust rejection of the null hypothesis that COVID-19 infection is independent of sex. 

1.9 is the odds ratio. This indicates that women who received a placebo had a roughly twofold higher risk of contracting COVID-19 compared to those who received the vaccination. This is important. Additionally, it indicates that the vaccination is probably efficacious. 

```{r}
effect <- Fsfish$p.value/(Fsfish$p.value +1)
effectivenessF = Fsfish$estimate/(Fsfish$estimate +1)*100
print(effectivenessF)
```

```{r}
low=(Fsfish$conf.int[1]/(Fsfish$conf.int[1] +1))*100
hi=(Fsfish$conf.int[2]/(Fsfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

## LGBTQ



## Druggies


# Overall Results and Conclusions